---
title: Functional diversity improves tropical forest resilience to disturbance
author: "Sylvain Schmitt, Isabelle Maréchaux, Jerome Chave, Fabien Fischer, Camille Piponiot, Stéphane Traissac & Bruno Hérault"
date: '`r Sys.Date()`'
output:
  bookdown::html_document2:
    number_sections: false
    toc: true
    toc_float: yes
  github_document: default
  bookdown::pdf_document2:
    includes:
      before_body: ./template/doc_prefix.tex
      in_header: ./template/preamble.tex
    number_sections: false
    toc: false
    keep_tex: true
  bookdown::word_document2: default
linestretch: 1.5
csl: /home/sylvain/Documents/Bibliography/csl/mee.csl
bibliography: /home/sylvain/Documents/Bibliography/library.bib
link-citations: yes
---

```{r config, message=FALSE, warning=FALSE, include=FALSE}
rm(list = ls()); invisible(gc())
library(knitr)
library(tidyverse)
opts_chunk$set( echo = F, message = F, warning = F, 
                fig.height = 8, fig.width = 8,
                cache = T, cache.lazy = F)
```

```{r resilience, echo=FALSE}
rich <- c(5,25,125)
cvh <- 1:20
dist <- c(0,25,50,75)
path <- '~/Documents/ECOFOG/Results/disturbance/disturbance/data'
load(file.path(path, 'disturbanceDOE.Rdata'))
load(file.path(path, 'disturbanceData.Rdata'))
load(file.path(path, 'disturbanceResilience.Rdata'))
```

```{r Deq, cache=TRUE, echo=FALSE}
deq <- data.frame(
  time = resilience$time,
  sim = resilience$sim,
  structure = apply(resilience[c('agb', 'ba', 'n', 'n10', 'n30')], 1, 
                  function(x) sqrt(sum((rep(1, length(x)) - x)^2))),
  production = apply(resilience[c('gpp', 'npp', 'Rday', 'Rnight')], 1, 
                  function(x) sqrt(sum((rep(1, length(x)) - x)^2)))
)
```

```{r Ieq, cache=TRUE, echo=FALSE}
sim <- c(sapply(c(sapply(rich, function(r) paste0(r, '.', cvh))), function(x) paste0(x, '.', dist[-1])))
Ieq <- sapply(sim, function(s){
  data_s <- subset(deq, sim ==s)
  return(cbind(data_s[c(1,2)], cumsum(data_s[-c(1,2)])))
}, simplify = F) ; rm(sim)
Ieq <- data.frame(do.call('rbind', Ieq))
names(Ieq)[3:4] <- paste0('Ieq.', names(Ieq)[3:4])
```

# Abstract

**To be written**

# Introduction 

Natural disturbances caused by the death of one or more trees, are the dominant forms of forest renewal in tropical forests as the creation of canopy gaps continuously modifies forest horizontal and vertical structure [@Veblen1992]. Today, climate change and other direct human activities are modifying forest disturbance regimes, with huge and under evaluated impacts. When human induced disturbances are high, it is referred to as "degraded forests" characterized by a modification of the forest ecosystem functioning, possibly reducing the furnished ecosystem services, while keeping the ecosystem as a forest, contrary to deforestation [@Simula2009]. Besides deforestation has been rightly the focus of worldwide attention, degradation has been less studied and quantified through tropics. The main source of degradation around the tropics is forest logging that encompass selective timber harvest, in native forests, and wood fuel harvest, often in secondary forests [@Pearson2017]. Tropical forests disturbances account for 2.07 billion of tons of carbon dioxide emissions per year [@Pearson2017], representing 20% of greenhouse gas emissions in the Brazilian Amazon [@Asner2005], estimating to cover areas 10 or more times larger than deforestation itself [@Herold2011]. Finally, disturbance in tropical forest dynamics induced by climate change likely results from significant changes in precipitation regime [@Davidson2012] with intense drought events resulting in huge mortality rates and biomass loss [@Phillips2009].

Tropical forest ecosystem response to disturbance depends first on the disturbance intensity itself. For instance, @DeAvila2015, focusing on timber and wood fuel harvest in Central Amazonia, found that when disturbance is high, e.g. induced by post logging sylvicultural practices had stronger negative effect on the post-disturbance system trajectory than logging itself. @Carreno-Rocabado2012 found no direct effect of disturbance intensity logging on community diversity itself but a community composition drift towards 'fast' acquisitive species [@reich_world-wide_2014]. However, even the short-term impact on biodiversity is unclear, as sometimes short term increase in diversity can occur at low disturbance intensities [@Martin2015].

The main reason of our lack of knowledge is the difficulty to conduct long term empirical study so that the use of forest simulators has become inevitable [@Huth2004]. Individual-based models of forest dynamics with species-explicit model parameters present the perfect framework to develop such joint biodiversity-ecosystem functioning studies [@Marechaux2017]. Starting from scratch, these models allow describing forest recovery through time, assessing individual tree recruitment, growth and mortality [@Bugmann2001]. Managing diversity in such models is still challenging and many models have built open Plant Functional Types to manage the volume of model parameters. [@Pacala1996].

Recently the forest growth simulator TROLL [@Chave1999], an individual-based and spatially-explicit forest model has been explicitly developed to deal with high diversity levels by using plant ecophysiological traits as surrogates of model parameters [@Marechaux2017]. Consequently, TROLL allow to fully simulate a highly-diverse system and offers the opportunity to study biodiversity-ecosystem functioning *in silico*.

Our work is based on the general hypothesis of a positive relationships between biodiversity and productivity. We assumed that when a disturbance event happen, due to a higher productivity, more diverse forests will recover quicker and thus be more resilient. This theoretical expectation stand on two processes: complementarity and selection effects [@Loreau2001]. Complementarity effect is the addition of better resources acquisition, due to resources partitioning and niche differentiation, and facilitation in diverse communities. Selection effect results from resources preemption by more competitive species. Moreover, we expect the sampling effect to improve resilience of species-rich forest, with redundancy and a lower risk to lose important functional traits.

Generally, positive relationship between biodiversity and productivity were empirically and experimentally demonstrated on grassland systems [@Hooper2005a; @Loreau2001a; @Naeem2002]; but few studies focused on the case of forests. One of the few studies was realized by @Chisholm2013 and has shown a positive significative relationship between species richness and wood productivity on a worldwide forest network. But those study still presents three major limits: (1) study time are inferior to a tree life time, (2) experimental network include scarcely disturbed plot, and (3) correlative approach does not explain mechanisms involved in the relationship.

In the present study, we thus focused on mechanisms involved in the relationship between biodiversity and forest ecosystem resilience. We used a simulation approach using TROLL model to assess long term processes for different levels of disturbances. We first assessed diversity effect on forest resilience of structure and functioning using numerous indices of taxonomic and functional diversities. Then, we measured biodiversity net effect, partitioned into complementarity and selection effects, on resilience of simulated tropical forest communities to disturbance.

# Material and Methods

## TROLL Model

TROLL is an individual-based and spatially explicit forest growth model. TROLL simulates the life cycle of individual trees from recruitment, with a diameter at breast height (dbh) above 1 cm, to death with growth and seed production. Trees are growing in a spatialized light environment explicitly computed within voxels of 1 $m^3$. Each tree is consistently defined by its age, diameter at breast height (dbh), height (h), crown radius (CR), crown depth (CD) and leaf area (LA). Tree geometry is calculated with allometric equations but leaf area vary dynamically within each crown following carbon allocations. Voxels resolution of 1 $m^3$ allow the establishment of maximum one tree by 1x1 m pixels. Each tree is flagged with a species label inherited from the parent tree through the seedling recruitment. A species label is associated to a number of species specific parameters (Table \@ref(tab:traits)) related to functional trait values. Carbon assimilation is computed over half-hourly period of a representative day. Then allocation is computed to simulate tree growth from an explicit carbon balance. Environment is updated at each time step set to one month. Seed-rains and seedlings are not simulated explicitly but as a pool. In addition below-ground processes, herbaceous plants, epiphytes and lianas are not simulated inside TROLL. The source code is written in C++ and available upon request. All modules of TROLL models are further detailed in @Marechaux2017. Following an underestimation of leaf lifespan for low LMA species, we designed our own leaf lifespan allometry, specific to tropical tree species, to be used in subsequent analysis (see supplementary materials S1).

```{r traits, echo=FALSE}
table <- data.frame(
  Abbreviation = c('$LMA$', '$N_m$', '$P_m$', '$wsg$', '$dbh_{thresh}$', '$h_{lim}$', '$a_h$'),
  Description = c('leaf mass per area', 'leaf nitrogen content per dry mass', 'leaf phosphorous content per dry mass', 'wood specific gravity', 'diameter at breasth height threshold', 'asymptotic height', 'parameter of the tree-height-dbh allometry'),
  Units = c('$g.m^{-2}$', '$mg.g^{-1}$', '$mg.g^{-1}$', '$g.cm^{-3}$', '$m$', '$m$', '$m$')
)
knitr::kable(table, caption = 'Species-specific parameters used in TROLL from @Marechaux2017 Data originates from the BRIDGE [@Baraloto2010] and TRY [@Kattge2011] datasets.', format = 'pandoc')
```

The disturbance module inside TROLL was designed in the simplest way by, for a given iteration $disturb_{iter}$, picking individual trees randomly up with a uniform law and without any individuals nor species targeting. Selected individuals are then removed without triggering a treefall to avoid any side effect. The operation is repeated until the disturbance result in a defined lost basal area ($disturb_{intensity}$).

## Design of experiment

In order to assess the role of biodiversity in ecosystem response to disturbance, we  simulated post-disturbance forest trajectories, encompassing both variation of disturbance intensity and biodiversity levels. The gradient of disturbance intensity was represented by percentage of basal area loss (0%, 25%, 50% and 75%). Biodiversity was assessed with two perspectives: taxonomic and functional. We used species richness $SR$ to simulate initial assemblages with diverse taxonomic diversity (5, 25, and 125 species). Functional diversity was assessed after running the initial simulations, *i.e.* before applying the disturbance. We focused on functional richness with convex hull volume $CHV$ and functional mean with community weighted mean $CWM$. For each level of species richness $SR$, we simulated 20 communities with a large range of convex hull volume $CHV$ but with a community weighted means close to the regional species pool community weighted means. This design of experiments resulted in 60 tree communities ($3~SR*20~CHV$) and 240 simulations ($60 ~communities*4~levels~of~disturbance$) over 600 years (maturity being assumed after 500 years of regeneration [@Marechaux2017]). Functional diversities at the end of simulations were assessed with @villeger_new_2008 indices (FRIC, FEve, FDiv, and FDis).

## Analysing Ecosystem Response

### Ecosystem structure and functioning

We described the simulated tropical forests from changes in values of forest structure (aboveground biomass ($AGB$ in $ton~C.ha^{-1}$), basal area ($BA$ in $m^2.ha^{-1}$), total number of stem ($N$), number of stem above $10~cm$ diameter ($N10$), and number of stem above $30~cm$ diameter ($N30$)) and in values of forest functioning (growth primary productivity ($GPP$ in $MgC.ha^{-1}$), net primary productivity ($NPP$ in $MgC.ha^{-1}$), tree autotrophic respiration in day ($Rday$ in $MgC.ha^{-1}$) and tree autotrophic respiration in night ($Rnight$ in $MgC.ha^{-1}$)). 

The resilience of forest structure and functioning values was assessed with:

\begin{equation}
  R\left(t\right)=\frac{Recovery\left(t\right)}{Loss\left(t_d\right)} \approx \frac{X_T(t)}{X_C(t)}
  (\#eq:Resilience)
\end{equation}

The resilience of the system $R(t)$ at the time $t$ is described by the ratio of recovery $Recovery(t)$ at time $t$ to loss suffered $Loss(t_d)$ at disturbance time $t_d$. But in our peculiar case of simulated forest ecosystems, the equilibrium used to calculate $Loss(t_d)$ is dynamic in time so that we simulated an undisturbed control ecosystem $C$. And the resilience of the system $R(t)$ at the time $t$ was defined as the ratio of the ecosystem metric values in the disturbed simulation $X_T(t)$ over the ecosystem metric values from the control $X_C(t)$ (the control simulations being relatively stable due to small stochasticity among TROLL simulations [@Marechaux2017]). $R(t)$  will be equal to $R_{eq} = 1$ when reaching the equilibrium value. Next, we calculated an euclidean distance to equilibrium $d_{eq}(t)$ as $d_{eq}(t) = \sqrt{(R_{eq} - R(t))^2}$. Ecosystem euclidean distance to equilibrium was calculated in a multi-dimensional space for (the two functions described above: (i) forest structure (AGB, BA, N, N10, and N30) and (ii) forest functioning (GPP, NPP, Rday, and Rnight). We then integrate the euclidean distances over time to get our ecosystem resilience indicators.

We then applied the following to each indicator:

1. Normalizing the treatment values by their corresponding control (Figure \@ref(fig:datatrans) A and B).
2. Respectively gathering forest structure and forest functioning together to get synthetic indicators (Figure \@ref(fig:datatrans) C)
3. Integration over time (Figure \@ref(fig:datatrans) D)
4. The ranking of simulations regarding disturbance intensity was highly stable over time for the 240 simulations. So we used the cumulative integral after 600 years $Ieq_{600}$ as a measurement of ecosystem resilience.

```{r datatrans, echo=FALSE, fig.cap='Ecosystem outputs data transformation. Ecosystem outputs (**A**) are normalized by the control value over time to calculate resilience (**B**); resilience of different ecosystem outputs is then used in a multidimensional space to caluclate ecosystem distance to equilibrium (**C**); finally distance at equilibrium is integrated over time in a cumulative sum (**D**). ', cache=TRUE, fig.height=8, fig.width=12, message=FALSE}
cols <- RColorBrewer::brewer.pal(3, "YlOrRd")
g_agb <- ecosystem %>% 
  left_join(., doe, by = 'sim') %>%
  filter(richness == 125) %>% 
  filter(cvh == 1) %>% 
  ggplot(aes(x = time, y = agb/1000, color = disturbance)) +
  geom_point() +
  xlab('Time (years)') +
  ylab('Aboveground biomass (tonC/ha)') +
  scale_color_manual('Disturbance\nintensity\n(% of BA)',
                       values=c("#999999", cols))
g_resilience <- resilience %>% 
  left_join(., doe, by = 'sim') %>%
  filter(richness == 125) %>% 
  filter(cvh == 1) %>% 
  ggplot(aes(x = time, y = agb, color = disturbance)) +
  geom_hline(yintercept = 1, col = 'red') +
  geom_point() +
  xlab('Time (years)') +
  ylab('Resilience of aboveground biomass') +
  scale_color_manual('Disturbance\nintensity\n(% of BA)',
                     values = cols)
g_deq <- deq %>% 
  left_join(., doe, by = 'sim') %>%
  filter(richness == 125) %>% 
  filter(cvh == 1) %>% 
  ggplot(aes(x = time, y = structure, 
             color = disturbance, fill = disturbance)) +
  geom_hline(yintercept = 0, col = 'red') +
  geom_point() +
  geom_area(alpha = 0.2) +
  xlab('Time (years)') +
  ylab('Distance to forest structure equilibrium\n(AGB, BA, N, N10 and N30)') +
  scale_color_manual('Disturbance\nintensity\n(% of BA)',
                     values = cols) +
  scale_fill_manual('Disturbance\nintensity\n(% of BA)',
                     values = cols)
g_Ieq <- Ieq %>% 
  left_join(., doe, by = 'sim') %>%
  filter(richness == 125) %>% 
  filter(cvh == 1) %>% 
  ggplot(aes(x = time, y = Ieq.structure, color = disturbance)) +
  geom_point() +
  xlab('Time (years)') +
  ylab('Cummulative integral of\ndistance to forest structure equilibrium\n(AGB, BA, N, N10 and N30)') +
  scale_color_manual('Disturbance\nintensity\n(% of BA)',
                     values = cols)
cowplot::plot_grid(g_agb, g_resilience, g_deq, g_Ieq, labels = LETTERS[1:4])
```

### Biodiversity effect

The effect of biodiversity on ecosystem resilience can be split in complementarity and selection effect using @Loreau2001 partitioning:

\begin{equation}
  \begin{array}{c}
    NE = X_O - X_E = CE + SE \\
    CE = N* \overline{\Delta RX} \overline{M}\\
    SE = N*cov(\Delta RX,M)
  \end{array}
  (\#eq:BiodivPart)
\end{equation}

Biodiversity net effect $NE$ is based on the difference between ecosystem variable $X$ observed value $X_O$ within the community mixture of species and its expected value $X_E$ if species performance were equal to their performance in monocultures. This effect can be partitioned between complementarity effect $CE$, representing niche partitioning, positive interactions, and resource supply, and selective effect $SE$ due to dominant species pool driving the ecosystem. $N$ represents the total number of species, and $M$ the vector of monocultures performance. Both metrics depend on the variation of relative ecosystem variable $\Delta RX$:

\begin{equation}
  \Delta RX_{sp} = \frac{X_{sp}(mixture)}{X_{sp}(monoculture)} - P_{sp}
  (\#eq:DeltaRY)
\end{equation}

$X_{sp}$ is the ecosystem variable value for one species either in mixture $X_{sp}(mixture)$ or in monoculture $X_{sp}(monoculture)$. $P_{sp}$ is the proportion of the species in the mixture represented by species relative abundance. Consequently, $CE$ averages diversity effects of all species presents in the mixture (both negatives and positives). Whereas $SE$ become positive when dominant species outperform themselves in mixture than in monoculture, and negative when less dominant species outperform themselves in mixture than in monoculture [@Tobner2016]. But similarly, to resilience measurement, biodiversity net effect $NE$ is a dynamic equilibrium and vary over time without disturbance. So in order to correctly assess selection and complementarity effect in answer to disturbance, we normalized it by undisturbed control ecosystem net effect $NE_C$ to measure treatments net effect resilience $R(NE_T)$:

\begin{equation}
  R(NE_T) = \frac{NE_T}{NE_C} = \frac{SE_T}{NE_C} + \frac{CE_T}{NE_C}
  (\#eq:RNE)
\end{equation}

Resilience trajectories of ecosystem variable after disturbance were partitioned between complementarity effect $CE$ and selection effect $SE$. In order to do that, we simulated the 163 species individually representing 652 simulations of monoculture.

# Results

## Ecosystem functions

Species richness was not directly link to $Ieq_{600}$. Increased functional diversity reduced cumulative integral from ecosystem distance to equilibrium after 600 years ($Ieq_{600}$). In addition, functional evenness was complementary reducing $Ieq_{600}$. Finally, low species richness could result in variant $Ieq_{600}$, but increased species richness resulted in increased functional diversity and consequently lower $Ieq_{600}$. We found similar results for all disturbance levels and forest functioning (see [Appendix 5: Disturbance simulations]).

```{r gIeq, echo=FALSE, fig.cap='Ecosystem resilience after 600 years with taxonomic and functional diversity for different levels of disturbance. Cummulative integral from ecosystem distance to forest structure equilibrium after 600 years was represented against functional diversity [FDiv, @villeger_new_2008] for different level of disturbance (25, 50 and 75% of total basal area); dot shapes represents the species richness whereas dot color represents functional evenness [FEve, @villeger_new_2008]. Solid lines and grey areas show fitted relationships with their mean and variance of the form $Ieq_600 = FDiv + \\epsilon$.', cache=TRUE, fig.width=12}
Ieq %>% 
  left_join(., doe, by = 'sim') %>% 
  filter(time == 600) %>% 
  ggplot(aes(x = FDiv, y = Ieq.structure, label = sim)) + 
  geom_smooth(method = 'lm', alpha = 0.3, colour= 'grey') +
  geom_point(aes(shape = richness, color = FEve)) +
  facet_wrap(~disturbance, scales = "free", labeller = 'label_both') + 
  xlab('Functional diversity (FDiv)') +
  ylab('Cummulative integral from ecosystem 
       distance to forest structure equilibrium after 600 years') +
  scale_shape_discrete('Species\nrichness\n(SR)') +
  scale_color_continuous('Functional\nevenness\n(FEve)')
```

## Biodiversity effect

```{r BE, echo=FALSE}
load(file.path(path, 'disturbanceBE.Rdata'))
load(file.path(path, 'disturbanceBErecovery.Rdata'))
```

The net biodiversity effect was partitioned between selection and complementarity effect after normalizing using undisturbed control simulation (see Table \@ref(tab:tNE)) to measure the resilience of each ecosystem measure, e.g. aboveground biomass (see Figure \@ref(fig:gBE)). We found that complementarity effect was dominant in the biodiversity net effect in the first decades. But after few decades the complementarity effect diminished toward an extremely low value. On the contrary, selection effect was reduced in the initial times after disturbance. It increased during the first decades and was then greater. The time lag for which complementarity effect overcame the selection effect increased with disturbance intensity. Finally, 600 years after disturbance, the biodiversity net effect on aboveground biomass was still not at equilibrium for a disturbance intensity greater than 25% of basal area. We found similar results but with an amplified signal for basal area ($BA$) and stem abundance ($N$ but with an inverted signal because of the forest self thinning) (see Supplementary materials S2). Finally, forest growth primary productivity ($GPP$) recovered in few years (proportionally to disturbance), and its net effect was maintained by complementarity effect (see Supplementary materials S2).

```{r tNE, echo=FALSE, cache=TRUE}
library(reshape2)
library(knitr)
BE %>%
  mutate(agb = agb/1000) %>% 
  filter(BE == 'NE') %>%
  melt(id.vars = c('BE', 'time', 'sim')) %>% 
  left_join(., doe, by = 'sim') %>%
  filter(richness == 125) %>%
  filter(disturbance == 0) %>%
  group_by(variable) %>% 
  summarise(mean = mean(value, na.rm = T), 
            'standard deviation' = sd(value, na.rm = T)) %>% 
  filter(variable != 'n30') %>% 
  bind_cols(., data.frame(
    name = c('aboveground biomass', 'basal area', 'number of stems', 
             'number of stems above 10cm dbh', 'growth primary production', 
             'net primary production', 'autotrophic respiration during day',
             'autotrophic respiration during night'),
    unit = c('$tonC.ha^{-1}$', '$m^2.ha^{-1}$', '$n.ha^{-1}$', '$n.ha^{-1}$', 
             '$MgC.ha^{-1}$', '$MgC.ha^{-1}$', '$MgC.ha^{-1}$', '$MgC.ha^{-1}$'))) %>% 
  kable(caption = 'Table 1: Mean value and standard deviation of biodiversity net effect accross mature simulations before the disturbance event for different ecosystem variable.', digits = 3, format = 'pandoc')
```

```{r gBE, echo=FALSE, fig.cap='Resilience of complementarity and selection effects. Complementarity effect (CE) and selection effect (SE) where normalized by control net effect (NEc), thus measuring their resilience over time. Solid lines represents the mean value whereas areas represents the interval of values among simulations.', cache=TRUE, fig.width=12}
BEresilience %>% 
  left_join(., doe, by = 'sim') %>%
  filter(richness == 125) %>% 
  filter(BE %in% c('SE', 'CE')) %>% 
  group_by(time, BE, disturbance, richness) %>%
  summarise(qt1 =quantile(agb, probs=0.05),
            qt2 =quantile(agb, probs=0.75),
            mean=mean(agb),
            n=n()) %>% 
  ggplot(aes(x = time)) +
  geom_hline(yintercept = 1, color = 'red') +
  geom_hline(yintercept = 0, color = 'blue') +
  geom_ribbon(aes(ymin = qt1, ymax = qt2, fill = BE), alpha = 0.3) +
  geom_line(aes(y = mean, color = BE)) +
  facet_grid(richness ~ disturbance, labeller = 'label_both') +
  xlab('Time (years)') +
  ylab('Recovery of aboveground biomass net effect')
```

# Discussion

In the limit of the model, we were able to show that functional diversity improved tropical forest resilience after disturbance. More particularly, functional diversity and evenness are key components of diversity in forest recovery trajectory after disturbance. Moreover, we found that complementarity between species was insuring forest recovery in the early times before more productive species dominate the forest and insure late recovery. We thus advocate the view that both diversity theory (with niche complementarity and facilitation) and mas ratio theory (represented by selection) are implied in ecosystem resilience but with relative importance depending on the spatial grain and time since the disturbance event.

## Functional diversity improve tropical forest resilience

Our results validated the hypothesis of a significative positive relationship between forest resilience and functional diversity and evenness ($p < 0.01$ and $p < 0.05$ respectively). More particularly, functional diversity [volume of the functional space occupied by the community, @villeger_new_2008] seems a major aspect of resilience if it's strengthened by a high functional evenness [regularity of the distribution of abundance in this volume, @villeger_new_2008]. Indeed, high functional diversity combined to high evenness avoid hegemonic effect of a few dominant species. Our results thus confirms both the review of @Diaz2001,advocating for an under-evaluated importance of plant functional diversity in ecosystem processes, and @Zhang2012 who highlighted the role of evenness in productivity and resilience of terrestrial ecosystems. Finally, species richness is not directly increasing resilience, thus supporting the idea that species diversity is often an inadequate surrogate of functional diversity [@Diaz2001; but see @Poorter2015]. Still, increased species richness will increase chance for high functional diversity through the sampling effect [@Loreau1998]. An higher sampling of regional species pool will allow a greater chance to pick more functionally diverse species.

<!-- OK good point. But you need to go more into the details of the diversity effect, perhaps highlighting the key choice of the traits? BH -->

## Complementarity and selection insure forest resilience

We found that complementary effect was insuring forest resilience in the beginning of forest successions. We interpreted this result as the consequence of facilitation processes or lower competition due to different niche. As the only resource currently simulated by TROLL is the light, the main facilitation would be light shading of post-pioneer species by pioneer species in disturbance gaps, confirming the study of @Morin2011 who also highlighted the importance of facilitation through light shading in forest resilience. But the complementarity effect quickly reduced through time, to let the selection effect insure forest resilience due to an re-enforced dominance of more productive species. The diminishing of complementarity effect is attributed to the selection of the most competitive species though time. 

In addition, the study scale matters as shown by @Chisholm2013 and @Sullivan2017. In this work, we look at processes to a 16-ha scale, being limited by the computational effort and, our simulation did not include topography resulting in the absence of micro environmental variation affecting both water and nutrient availability. Because many studies suggest that, in mature ecosystems, complementarity will be stronger at smaller scale [@Chisholm2013; @Sullivan2017], this could explain the low value of complementarity after the initial stages of forest recovery. Still, the absence of topography and environmental heterogeneity in our simulations could explain why we observed an effect of complementarity to a 16-ha scale, strengthening @Sullivan2017 interpretation.

Our results follows several studies advocating for multiple mechanisms through which functional diversity affect ecosystem functions. Complementarity effect encompass niche complementarity theory (or diversity theory), which has been shown to indirectly improve forest biomass and coarse wood productivity in subtropical forest [@Chiang2016]. Similarly, complementarity has been shown of primary importance in grassland functioning [@Cardinale2007; @Isbell2011]. On the other hand, selection effect can be related to the mass ratio hypothesis, which proposes that ecosystem functions are regulated by dominant species of the community [@Grime1998]. And mass ratio theory has been shown to primarily influence ecosystem functions with biomass accumulation (aboveground and shoots), productivity (coarse wood or aboveground), water use, and light interception for both grassland and subtropical forests [@Chiang2016; @Mokany2008]. Consequently, concerning mechanisms responsible for the positive effect of functional diversity on tropical forest functions after disturbance, we also advocate for the interplay of both niche complementarity and mass ratio theories, depending on time since the disturbance event and the spatial grain.

Finally, our findings confirm results from experimental studies. @Williams2017 also found experimentally an over yielding due to complementarity effect based on light and spatial complementarity with tree crown of young trees. In addition, @Tobner2016 studied 4-years stand in low diverse forests of Canada. They also found that selection effect was greater than complementarity in most of the cases, promoting the idea that mass ratio theory is the primary mechanisms involved in functional diversity effect on ecosystem functions [@Mokany2008].

## Conclusion

We used closed forest system simulated with TROLL forest model to evaluate the role and mechanisms of biodiversity in tropical forest resilience to disturbance. We found that diversity improved forest resilience, similarly to productivity [@Liang2016; @Poorter2015]. Additionally, we found that complementarity between species was insuring forest recovery in forest succession start with facilitation, before more productive species dominate the forest and insure the final forest recovery.

# Supplementary materials

* Supplementary materials S1: Leaf lifespan model
    + [HTML](S1.html)
    + [PDF](S1.pdf)
* Supplementary materials S2: Disturbance simulations
    + [HTML](S2.html)
    + [PDF](S2.pdf)
    
# References
